<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Don&#39;t Spill the Beans - Keep Your Secrets Secure ðŸ¤« - DevJev.nl | Azure, Cloud Security &amp; DevOps Insights for IT Professionals</title><meta name="author" content="Jev">
<meta name="description" content="Don&#39;t spill the beans - keep your secrets secure"><meta name="keywords" content='Cloud Security, Cloud Automation, PowerShell, Way of Working, Local Dev, Security Hygiene, SecretManagement, SecretStore'>
  <meta itemprop="name" content="Don&#39;t spill the beans - keep your secrets secure ðŸ¤«">
  <meta itemprop="description" content="Don&#39;t spill the beans - keep your secrets secure">
  <meta itemprop="datePublished" content="2023-06-26T05:00:00+02:00">
  <meta itemprop="dateModified" content="2023-06-26T05:00:00+02:00">
  <meta itemprop="wordCount" content="850">
  <meta itemprop="image" content="https://www.devjev.nl/posts/2023/dont-spill-the-beans-keep-your-secrets-secure/featured-image.png">
  <meta itemprop="keywords" content="Cloud Security,Cloud Automation,PowerShell,Way of Working,Local Dev,Security Hygiene,SecretManagement,SecretStore"><meta property="og:url" content="https://www.devjev.nl/posts/2023/dont-spill-the-beans-keep-your-secrets-secure/">
  <meta property="og:site_name" content="DevJev.nl | Azure, Cloud Security & DevOps Insights for IT Professionals">
  <meta property="og:title" content="Don&#39;t spill the beans - keep your secrets secure ðŸ¤«">
  <meta property="og:description" content="Don&#39;t spill the beans - keep your secrets secure">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-06-26T05:00:00+02:00">
    <meta property="article:modified_time" content="2023-06-26T05:00:00+02:00">
    <meta property="article:tag" content="Cloud Security">
    <meta property="article:tag" content="Cloud Automation">
    <meta property="article:tag" content="PowerShell">
    <meta property="article:tag" content="Way of Working">
    <meta property="article:tag" content="Local Dev">
    <meta property="article:tag" content="Security Hygiene">
    <meta property="og:image" content="https://www.devjev.nl/posts/2023/dont-spill-the-beans-keep-your-secrets-secure/featured-image.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.devjev.nl/posts/2023/dont-spill-the-beans-keep-your-secrets-secure/featured-image.png">
  <meta name="twitter:title" content="Don&#39;t spill the beans - keep your secrets secure ðŸ¤«">
  <meta name="twitter:description" content="Don&#39;t spill the beans - keep your secrets secure">
      <meta name="twitter:site" content="@DevJevNL">
<meta name="twitter:creator" content="@DevJevNL" /><meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="https://www.devjev.nl/posts/2023/dont-spill-the-beans-keep-your-secrets-secure/" title="Don&#39;t spill the beans - keep your secrets secure ðŸ¤« - DevJev.nl | Azure, Cloud Security &amp; DevOps Insights for IT Professionals" /><link rel="prev" type="text/html" href="https://www.devjev.nl/posts/2023/sleep-worry-free-the-best-tips-for-local-secrets-management/" title="Sleep Worry-Free: The best tips for Local Secrets Management ðŸ’¤" /><link rel="next" type="text/html" href="https://www.devjev.nl/posts/2023/mastering-cloud-adoption-framework-quick-start-backlog-essentials/" title="Mastering Cloud Adoption Framework: Quick Start Backlog essentials ðŸ’ª" /><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Don't spill the beans - keep your secrets secure ðŸ¤«",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/www.devjev.nl\/posts\/2023\/dont-spill-the-beans-keep-your-secrets-secure\/"
    },"image": [{
              "@type": "ImageObject",
              "url": "https:\/\/www.devjev.nl\/posts\/2023\/dont-spill-the-beans-keep-your-secrets-secure\/featured-image.png",
              "width":  1200 ,
              "height":  675 
            }],"genre": "posts","keywords": "Cloud Security, Cloud Automation, PowerShell, Way of Working, Local Dev, Security Hygiene, SecretManagement, SecretStore","wordcount":  850 ,
    "url": "https:\/\/www.devjev.nl\/posts\/2023\/dont-spill-the-beans-keep-your-secrets-secure\/","datePublished": "2023-06-26T05:00:00+02:00","dateModified": "2023-06-26T05:00:00+02:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Jev"
      },"description": "Don't spill the beans - keep your secrets secure"
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="fixed" data-header-mobile="auto"><div class="wrapper" data-page-style="custom"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="DevJev.nl | Azure, Cloud Security &amp; DevOps Insights for IT Professionals"><span class="header-title-text">DevJev.nl</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/" title="Blog posts">Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/" title="Post categories">Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/" title="Tags used in posts">Tags</a></li><li class="menu-item">
              <a class="menu-link" href="/about/" title="About Me">About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Search titles or contents ..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="DevJev.nl | Azure, Cloud Security &amp; DevOps Insights for IT Professionals"><span class="header-title-text">DevJev.nl</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Search titles or contents ..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Cancel
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/posts/" title="Blog posts">Posts</a></li><li class="menu-item"><a class="menu-link" href="/categories/" title="Post categories">Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/" title="Tags used in posts">Tags</a></li><li class="menu-item"><a class="menu-link" href="/about/" title="About Me">About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Don&#39;t Spill the Beans - Keep Your Secrets Secure ðŸ¤«</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      Jev</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/secure-development/" class="post-category" title="Category - Secure Development"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Secure Development</a>&ensp;<a href="/categories/powershell/" class="post-category" title="Category - PowerShell"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> PowerShell</a></span></div><div class="post-meta-line"><span title="published on 2023-06-26 05:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2023-06-26">2023-06-26</time></span>&nbsp;<span title="850 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 900 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>4 minutes</span>&nbsp;</div>
    </div><div class="featured-image"><img src='/posts/2023/dont-spill-the-beans-keep-your-secrets-secure/featured-image.png' alt="/posts/2023/dont-spill-the-beans-keep-your-secrets-secure/featured-image.png"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#modules-explained">Modules explained</a>
      <ul>
        <li><a href="#powershell-secretmanagement-module">PowerShell SecretManagement module</a></li>
        <li><a href="#powershell-secretstore">PowerShell SecretStore</a></li>
      </ul>
    </li>
    <li><a href="#set-up-your-secure-store">Set-up your Secure Store</a></li>
    <li><a href="#register-a-new-vault">Register a new vault</a></li>
    <li><a href="#use-the-new-vault">Use the new vault</a>
      <ul>
        <li><a href="#unlock-the-vault">Unlock the vault</a></li>
        <li><a href="#add-secrets-to-the-vault">Add secrets to the vault</a></li>
        <li><a href="#connect-azaccount-with-vault-secrets">Connect-AzAccount with vault secrets</a></li>
        <li><a href="#azure-devops-api-with-vault-secrets">Azure DevOps API with vault secrets</a></li>
      </ul>
    </li>
    <li><a href="#wrapping-up">Wrapping up</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>In the previous post <a href="/posts/2023//sleep-worry-free-the-best-tips-for-local-secrets-management">Sleep Worry-Free: The best tips for Local Secrets Management</a> I shared the best tips for managing local secrets. In this post I will take <code>Secrets Management</code> to the next level by showing you how to create manage and use secrets securely by setting up a local secure store using <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.secretmanagement/?view=ps-modules"target="_blank" rel="external nofollow noopener noreferrer">PowerShell SecretManagement</a> and <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.secretstore/?view=ps-modules"target="_blank" rel="external nofollow noopener noreferrer">PowerShell SecretStore</a> modules.</p>
<h2 class="heading-element" id="modules-explained"><span>Modules explained</span>
  <a href="#modules-explained" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Since this approach to <code>Secrets Management</code> depends on the two just mentioned modules the purpose of each of the modules is explained next.</p>
<h3 class="heading-element" id="powershell-secretmanagement-module"><span>PowerShell SecretManagement module</span>
  <a href="#powershell-secretmanagement-module" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Important to note here is that this module does not store any secrets it is a uniform interaction layer to to access and manage secrets stored different kind of extension vaults.
This module supports managing the following secret data types:</p>
<ul>
<li>byte[]</li>
<li>string</li>
<li>SecureString</li>
<li>PSCredential</li>
<li>Hashtable</li>
</ul>
<h3 class="heading-element" id="powershell-secretstore"><span>PowerShell SecretStore</span>
  <a href="#powershell-secretstore" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>The SecretStore module is an extension vault for the just mentioned <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.secretmanagement/?view=ps-modules"target="_blank" rel="external nofollow noopener noreferrer">PowerShell SecretManagement</a> module. This is the module that stores secrets and it does so locally within the current user context. It uses the <em>.NET crypto APIs</em> to encrypt the file which is used ot store the secrets. Since this modules works in all by PowerShell supported Operating systems it runs on Windows, Linux and macOS.<br>
By default the store requires a password for unlocking it, this is done to provide the strongest. As all other extension vaults this vault is registered to the current logged in user context, and is available only to the user in question. The extension vault registry file is stored in the user account protected directory.</p>
<p>For Windows platforms the location is:</p>
<ul>
<li><code>%LOCALAPPDATA%\Microsoft\PowerShell\secretmanagement</code></li>
</ul>
<p>For non-Windows platforms the location:</p>
<ul>
<li><code>$HOME/.secretmanagement</code></li>
</ul>
<h2 class="heading-element" id="set-up-your-secure-store"><span>Set-up your Secure Store</span>
  <a href="#set-up-your-secure-store" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>The first step is to make sure that the two modules are installed and loaded, namely;</p>
<ul>
<li>Microsoft.PowerShell.SecretStore</li>
<li>Microsoft.PowerShell.SecretManagement</li>
</ul>
<p>For this I used a simple ForEach loop which checks if the modules are already installed both are loaded if not both are installed and then loaded. The snippet I use is as follows:</p>
<script src="https://gist.github.com/devjevnl/24640123dfe48636887b70786fb16916.js?file=set-up-your-secure-store.ps1"></script>
<h2 class="heading-element" id="register-a-new-vault"><span>Register a new vault</span>
  <a href="#register-a-new-vault" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>To register a new vault a <code>SecureString</code> password is required. This password is exported into an XML file and encrypted by Windows Data Protection (DPAPI) using the <code>Export-Clixml</code> command. Next a new vault is created using the <code>Register-SecretVault</code> command. To complete the registration of the vault the just created password is used to secure it and the following configurations values are also set.</p>
<ul>
<li>Authentication  &lt;- Setting this parameter to <code>Password</code>  Ensures a password is required to secure the concerning vault</li>
<li>PasswordTimeout&lt;- The amount of time the vault stays unlocked after using the password, the default is 15 minutes however I like to set it to 3600 seconds (1 hour)</li>
<li>Interaction &lt;- Specifies whether the SecretStore should prompt a user when they access it. I used <code>none</code> to be able to run the whole thing via an automation script.</li>
<li>Password &lt;- the actual password encrypted using <code>Export-Clixml</code>. Needed when previous parameter is set to <code>none</code>.</li>
<li>Confirm &lt;- Prompts you for confirmation before running the cmdlet. I set it to $false since I intend to execute it via an automation script.</li>
</ul>
<p>I combine the above settings into a function based on the following snippet:</p>
<script src="https://gist.github.com/devjevnl/24640123dfe48636887b70786fb16916.js?file=register-a-new-vault.ps1"></script>
<h2 class="heading-element" id="use-the-new-vault"><span>Use the new vault</span>
  <a href="#use-the-new-vault" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>The first step to start using the newly created vault is to make sure it&rsquo;s unlocked. For this the password used during the creation must be provided using the <code>Unlock-SecretStore</code> command. With the vault unlocked the <code>Set-Secret</code> and <code>Get-Secret</code> can be used to store and retrieve secrets.</p>
<div class="details admonition info open">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-circle-info" aria-hidden="true"></i>Info<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
  <div class="details-content">
    <div class="admonition-content">An interesting mention is that it is possible set an expiration date using the <code>-Metadata</code> parameter. Naturally the extension vault itself must support it this as not all do.</div>
  </div>
</div>
<p>Before starting a debug session I simply use the <code>Set-Secret</code> command to store te required secrets in the vault and use them in my throw away / one time use PowerShell script <code>Jevs-Playground.ps1</code>. For details on this script please check out my previous post <a href="posts/2023//sleep-worry-free-the-best-tips-for-local-secrets-management">Sleep Worry-Free: The best tips for Local Secrets Management</a>.</p>
<p>Check-out the next examples as these contain the snippets I used at one time or another for development and debugging.</p>
<h3 class="heading-element" id="unlock-the-vault"><span>Unlock the vault</span>
  <a href="#unlock-the-vault" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Simply use <code>Unlock-SecretStore</code> command, but make sure to provide path to your secure store password xml file.</p>
<script src="https://gist.github.com/devjevnl/24640123dfe48636887b70786fb16916.js?file=use-the-new-vault-unlock-vault.ps1"></script>
<h3 class="heading-element" id="add-secrets-to-the-vault"><span>Add secrets to the vault</span>
  <a href="#add-secrets-to-the-vault" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Use the <code>Set-Secret</code> command to add secrets to the vault.
<script src="https://gist.github.com/devjevnl/24640123dfe48636887b70786fb16916.js?file=use-the-new-vault-set-secret.ps1"></script></p>
<h3 class="heading-element" id="connect-azaccount-with-vault-secrets"><span>Connect-AzAccount with vault secrets</span>
  <a href="#connect-azaccount-with-vault-secrets" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Get the app id, app secret and the tenant id secrets and pass these into the Connect-AzAccount. The app secret does not need to be read as plain text and should be passed as <code>System.Security.SecureString</code> directly.</p>
<script src="https://gist.github.com/devjevnl/24640123dfe48636887b70786fb16916.js?file=use-the-new-vault-az-connect.ps1"></script>
<h3 class="heading-element" id="azure-devops-api-with-vault-secrets"><span>Azure DevOps API with vault secrets</span>
  <a href="#azure-devops-api-with-vault-secrets" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Get the PAT token from the vault, craft a authentication header using the token and simply execute <code>Invoke-RestMethod</code>.</p>
<script src="https://gist.github.com/devjevnl/24640123dfe48636887b70786fb16916.js?file=use-the-new-vault-ado-connect.ps1"></script>
<h2 class="heading-element" id="wrapping-up"><span>Wrapping up</span>
  <a href="#wrapping-up" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>I hope you enjoyed this post and now have a better understanding of the possibilities to manage secrets locally during debugging. If you are interested in the reference material used to make this post, please visit the following links. As always, a big <strong>thanks</strong> for reading this post. If you liked it, don&rsquo;t be shy and have a look at my other <a href="/posts">posts</a>.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.secretmanagement/?view=ps-modules"target="_blank" rel="external nofollow noopener noreferrer">Microsoft.PowerShell.SecretManagement</a></li>
<li><a href="https://github.com/PowerShell/SecretManagement"target="_blank" rel="external nofollow noopener noreferrer">SecretManagement</a></li>
<li><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.secretstore/?view=ps-modules"target="_blank" rel="external nofollow noopener noreferrer">Microsoft.PowerShell.SecretStore</a></li>
<li><a href="https://github.com/PowerShell/SecretStore"target="_blank" rel="external nofollow noopener noreferrer">SecretStore</a></li>
<li><a href="https://learn.microsoft.com/en-us/powershell/utility-modules/secretmanagement/how-to/using-secrets-in-automation?view=ps-modules"target="_blank" rel="external nofollow noopener noreferrer">Using the SecretStore in automation</a></li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/standard/security/cryptography-model"target="_blank" rel="external nofollow noopener noreferrer">.NET cryptography model</a></li>
</ul>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Updated on 2023-06-26 05:00:00">Updated on 2023-06-26&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/cloud-security/" class="post-tag" title="Tags - Cloud Security">Cloud Security</a><a href="/tags/cloud-automation/" class="post-tag" title="Tags - Cloud Automation">Cloud Automation</a><a href="/tags/powershell/" class="post-tag" title="Tags - PowerShell">PowerShell</a><a href="/tags/way-of-working/" class="post-tag" title="Tags - Way of Working">Way of Working</a><a href="/tags/local-dev/" class="post-tag" title="Tags - Local Dev">Local Dev</a><a href="/tags/security-hygiene/" class="post-tag" title="Tags - Security Hygiene">Security Hygiene</a><a href="/tags/secretmanagement/" class="post-tag" title="Tags - SecretManagement">SecretManagement</a><a href="/tags/secretstore/" class="post-tag" title="Tags - SecretStore">SecretStore</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/2023/sleep-worry-free-the-best-tips-for-local-secrets-management/" class="post-nav-item" rel="prev" title="Sleep Worry-Free: The Best Tips for Local Secrets Management ðŸ’¤"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Sleep Worry-Free: The Best Tips for Local Secrets Management ðŸ’¤</a><a href="/posts/2023/mastering-cloud-adoption-framework-quick-start-backlog-essentials/" class="post-nav-item" rel="next" title="Mastering Cloud Adoption Framework: Quick Start Backlog Essentials ðŸ’ª">Mastering Cloud Adoption Framework: Quick Start Backlog Essentials ðŸ’ª<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="custom-footer-text">
  <p>Â© 2025 Jev Suchoi - Let's automate the boring! </p>
</div>
<div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/posts/2023/dont-spill-the-beans-keep-your-secrets-secure/config.js" defer></script><script src="/js/theme.min.js" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-J3E897NYLC');
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-J3E897NYLC" async></script></body>
</html>
