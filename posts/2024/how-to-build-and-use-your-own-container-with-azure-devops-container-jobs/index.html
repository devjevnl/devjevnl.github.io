<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>üõ†Ô∏è How to Build and Use Your Own Container With Azure DevOps Container Jobs üöÄüì¶ - DevJev.nl | Azure, Cloud Security &amp; DevOps Insights for IT Professionals</title><meta name="author" content="Jev">
<meta name="description" content="How to create your own container to use in container jobs?"><meta name="keywords" content='Container Jobs, Containers, Microsoft Hosted Agents, Self-Hosted Agents, Azure DevOps, Azure Container Registry, Docker, Bicep, Packer, Terraform, Chocolatey, PowerShell'>
  <meta itemprop="name" content="üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶">
  <meta itemprop="description" content="How to create your own container to use in container jobs?">
  <meta itemprop="datePublished" content="2024-02-23T02:00:00+02:00">
  <meta itemprop="dateModified" content="2024-02-23T02:00:00+02:00">
  <meta itemprop="wordCount" content="1716">
  <meta itemprop="image" content="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg">
  <meta itemprop="keywords" content="Container Jobs,Containers,Microsoft Hosted Agents,Self-Hosted Agents,Azure DevOps,Azure Container Registry,Docker,Bicep,Packer,Terraform,Chocolatey,PowerShell"><meta property="og:url" content="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/">
  <meta property="og:site_name" content="DevJev.nl | Azure, Cloud Security & DevOps Insights for IT Professionals">
  <meta property="og:title" content="üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶">
  <meta property="og:description" content="How to create your own container to use in container jobs?">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-23T02:00:00+02:00">
    <meta property="article:modified_time" content="2024-02-23T02:00:00+02:00">
    <meta property="article:tag" content="Container Jobs">
    <meta property="article:tag" content="Containers">
    <meta property="article:tag" content="Microsoft Hosted Agents">
    <meta property="article:tag" content="Self-Hosted Agents">
    <meta property="article:tag" content="Azure DevOps">
    <meta property="article:tag" content="Azure Container Registry">
    <meta property="og:image" content="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg">
  <meta name="twitter:title" content="üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶">
  <meta name="twitter:description" content="How to create your own container to use in container jobs?">
      <meta name="twitter:site" content="@DevJevNL">
<meta name="twitter:creator" content="@DevJevNL" /><meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/" title="üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶ - DevJev.nl | Azure, Cloud Security &amp; DevOps Insights for IT Professionals" /><link rel="prev" type="text/html" href="https://www.devjev.nl/posts/2024/azure-devops-container-jobs-when-microsoft-and-self-hosted-agents-meet-its-the-best-of-both-worlds/" title="üöÄ Azure DevOps Container Jobs: When Microsoft and Self-Hosted Agents meet, It&#39;s the Best of Both Worlds! üåêüõ†Ô∏è" /><link rel="next" type="text/html" href="https://www.devjev.nl/posts/2024/400-bad-request-access-to-outlook-on-the-web-has-been-blocked-by-your-organization/" title="üö´ 400 Bad Request. Access to Outlook on the web has been blocked by your organization üõë‚úâÔ∏èüîí" /><link rel="stylesheet" href="/css/config.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/www.devjev.nl\/posts\/2024\/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs\/"
    },"image": [{
              "@type": "ImageObject",
              "url": "https:\/\/www.devjev.nl\/posts\/2024\/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs\/featured-image.jpg",
              "width":  500 ,
              "height":  690 
            }],"genre": "posts","keywords": "Container Jobs, Containers, Microsoft Hosted Agents, Self-Hosted Agents, Azure DevOps, Azure Container Registry, Docker, Bicep, Packer, Terraform, Chocolatey, PowerShell","wordcount":  1716 ,
    "url": "https:\/\/www.devjev.nl\/posts\/2024\/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs\/","datePublished": "2024-02-23T02:00:00+02:00","dateModified": "2024-02-23T02:00:00+02:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Jev"
      },"description": "How to create your own container to use in container jobs?"
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="fixed" data-header-mobile="auto"><div class="wrapper" data-page-style="custom"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="DevJev.nl | Azure, Cloud Security &amp; DevOps Insights for IT Professionals"><span class="header-title-text">DevJev.nl</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/" title="Blog posts">Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/" title="Post categories">Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/" title="Tags used in posts">Tags</a></li><li class="menu-item">
              <a class="menu-link" href="/about/" title="About Me">About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="Search titles or contents ..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="DevJev.nl | Azure, Cloud Security &amp; DevOps Insights for IT Professionals"><span class="header-title-text">DevJev.nl</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="Search titles or contents ..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              Cancel
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/posts/" title="Blog posts">Posts</a></li><li class="menu-item"><a class="menu-link" href="/categories/" title="Post categories">Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/" title="Tags used in posts">Tags</a></li><li class="menu-item"><a class="menu-link" href="/about/" title="About Me">About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="fi-container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>üõ†Ô∏è How to Build and Use Your Own Container With Azure DevOps Container Jobs üöÄüì¶</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      Jev</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/azure-devops/" class="post-category" title="Category - Azure DevOps"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Azure DevOps</a>&ensp;<a href="/categories/container-jobs/" class="post-category" title="Category - Container Jobs"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Container Jobs</a>&ensp;<a href="/categories/containers/" class="post-category" title="Category - Containers"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Containers</a></span></div><div class="post-meta-line"><span title="published on 2024-02-23 02:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-02-23">2024-02-23</time></span>&nbsp;<span title="1716 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 1800 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>9 minutes</span>&nbsp;</div>
    </div><div class="featured-image"><img src='/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg' alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg"></div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#target-set-up">Target set-up</a>
      <ul>
        <li><a href="#setting-up-the-required-infrastructure">Setting up the required infrastructure</a></li>
        <li><a href="#building-and-storing-the-container">Building and storing the container</a></li>
        <li><a href="#using-the-container-in-an-azure-devops-pipeline">Using the container in an Azure DevOps pipeline</a></li>
      </ul>
    </li>
    <li><a href="#wrapping-up">Wrapping up</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>In my previous post <a href="/posts/2024/azure-devops-container-jobs-when-microsoft-and-self-hosted-agents-meet-its-the-best-of-both-worlds">üöÄ Azure DevOps Container Jobs: When Microsoft and Self-Hosted Agents meet, It&rsquo;s the Best of Both Worlds! üåêüõ†Ô∏è</a> you where able experience Azure DevOps container jobs. In this post I am delivering on my promise and explain set-by-step how to build and use your own container with Azure DevOps Container Jobs. Buckle up, and let&rsquo;s get started!</p>
<h2 class="heading-element" id="target-set-up"><span>Target set-up</span>
  <a href="#target-set-up" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Lets start by having a look at the target set-up.</p>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png" data-sub-html="<h2>Target set-up</h2>"><img loading="lazy" src='/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png' alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png" height="1472" width="1302"></a><figcaption class="image-caption">Target set-up</figcaption>
  </figure>
<p>The goal of this set-up is to fist build your own container then store the container in a container registry and finally use the container in an Azure DevOps pipeline as a container job. Naturally some infrastructure needs to be in place to make this happen, but thats nothing to worry about as everything needed for to achieve the target set-up is included in this post.</p>
<p>With a clear understanding of what we want to achieve lets start building it.</p>
<div class="details admonition warning open">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-exclamation-triangle" aria-hidden="true"></i>Prerequisites<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
  <div class="details-content">
    <div class="admonition-content"><p>The next chapters assume that you have met the following prerequisites:</p>
<ul>
<li>An Azure DevOps Organization with a Microsoft hosted agent is available and accessible to you</li>
<li>A project in the concerning Azure DevOps organization exists
<ul>
<li>Contributor and Endpoint Administrator roles granted to your identity in this project</li>
</ul>
</li>
<li>A n initialized Git repo in the concerning project is present</li>
<li>You have access to an Azure Subscription with contributor permissions</li>
<li>Your engineering/development environment has been set up as follow
<ul>
<li>Your environment has the latest PowerShell version installed</li>
<li>Your environment has the latest Az module installed</li>
<li>Your environment has the latest Bicep version installed</li>
</ul>
</li>
</ul></div>
  </div>
</div>
<h3 class="heading-element" id="setting-up-the-required-infrastructure"><span>Setting up the required infrastructure</span>
  <a href="#setting-up-the-required-infrastructure" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="details admonition note open">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true"></i>Note<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
  <div class="details-content">
    <div class="admonition-content">The steps in this chapter are to ensure that everyone can follow the instructions disregarding the level of experience with the subjects at hand. If you are already familiar with Infrastructure as Code in Azure and how to set-up Service Connections in Azure DevOps you can probably skip most of the steps if not the whole chapter.</div>
  </div>
</div>
<p>Our first task is to create a place to store the container after it has been built. For this we are going to use an <a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-intro?wt.mc_id=DT-MVP-5005327"target="_blank" rel="external nofollow noopener noreferrer">Azure Container registry</a>.</p>
<ol>
<li>
<p>Open a PowerShell terminal and connect to your Azure subscription by running the following snippet. Make sure fill your <a href="https://learn.microsoft.com/en-us/azure/azure-portal/get-subscription-tenant-id?wt.mc_id=DT-MVP-5005327"target="_blank" rel="external nofollow noopener noreferrer">subscription id and tenant id</a>.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=connectAzSubscription.ps1"></script></p>
</li>
<li>
<p>Next lets create a resource group by running the following snippet. Feel free to change the resource group name to something of your choice.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=createResourceGroup.ps1"></script></p>
</li>
<li>
<p>Now save the following snippet as  a file named <code>basicContainerRegistry.bicep</code> to your local machine.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=basicContainerRegistry.bicep"></script></p>
</li>
<li>
<p>The prerequisites to create an Azure Container Registry are met. Run the following snippet in the PowerShell terminal opened in step 1 to start the deployment.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=deployBasicContainerRegistry.ps1"></script></p>
<p>Assuming the deployment was successful you should see something like this in the terminal. It&rsquo;s also possible to verify the result using the Azure portal.
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png" data-sub-html="<h2>Successful Bicep deployment</h2>"><img loading="lazy" src='/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png' alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png" height="316" width="781"></a><figcaption class="image-caption">Successful Bicep deployment</figcaption>
     </figure></p>
</li>
<li>
<p>We are ready to create a service connection in Azure DevOps to the container registry. This service connection will be used to push the container to the just created container registry.
<div class="details admonition warning open">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-exclamation-triangle" aria-hidden="true"></i>Prerequisites<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
  <div class="details-content">
    <div class="admonition-content">Make sure you have the necessary permissions to create a service connection in Azure DevOps. Meaning your identity has at least contributor role for the concerning project.
Also make sure the same identity has direct or inherited Owner permissions on the newly created Azure Container Registry.</div>
  </div>
</div></p>
<ol>
<li>Open the Azure DevOps portal and navigate to the project you want to use the container registry in.</li>
<li>In the project navigate to <code>Project settings</code> and then <code>Service connections</code>.</li>
<li>Click <code>New service connection</code> in the top right corner and select <code>Docker Registry</code> as the connection type, click next.</li>
<li>For <code>Registry type</code> select <code>Azure Container Registry</code> and for <code>Authentication Type</code> select <code>Service Principal</code>, a list of subscriptions should be loaded within a couple of seconds.</li>
<li>Select the subscription where the newly created container registry is located and select the correct container registry from the list of available container registries.</li>
<li>Give the service connection a name, in this guide the name of the Azure container Registry is used but you can use any name you like.</li>
<li>Write a proper description and click <code>Save</code>. The service connection is now available for use in the project.</li>
</ol>
</li>
</ol>
<p>All the prerequisites are now in place to start building the container.</p>
<h3 class="heading-element" id="building-and-storing-the-container"><span>Building and storing the container</span>
  <a href="#building-and-storing-the-container" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Our next task is create a container definition, a pipeline to build the container and finally push the finished result to the container registry we just created in the previous chapter.</p>
<ol>
<li>Assuming you still have your Azure DevOps Project open in your browser, select your repo, create a new file called <code>myContainer.DockerFile</code> and paste the following snippet into the file.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=myContainer.DockerFile"></script></li>
</ol>
<div class="details admonition tip open">
  <div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden="true"></i>Tip<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></div>
  <div class="details-content">
    <div class="admonition-content">Review the Docker file, you should notice that it uses the PowerShell 7.3 image from the <a href="https://mcr.microsoft.com/"target="_blank" rel="external nofollow noopener noreferrer">Microsoft Container Registry</a> as a base, adds a couple of preview PowerShell modules to it and finally installs <a href="https://chocolatey.org/"target="_blank" rel="external nofollow noopener noreferrer">Chocolatey</a>. Chocolatey is then used to install <a href="https://www.packer.io/"target="_blank" rel="external nofollow noopener noreferrer">Packer</a>, <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview?tabs=bicep&amp;wt.mc_id=DT-MVP-5005327"target="_blank" rel="external nofollow noopener noreferrer">Bicep</a> and <a href="https://www.terraform.io/"target="_blank" rel="external nofollow noopener noreferrer">Terraform</a>. It is completely up to you what you want to add to the container, this set-up is an example to showcase the possibilities, and give you some inspiration.</div>
  </div>
</div>
<ol start="2">
<li>
<p>Next Commit the file using the button in the top right corner. Preferably you should use an IDE like <a href="https://code.visualstudio.com/"target="_blank" rel="external nofollow noopener noreferrer">Visual Studio Code</a> and <a href="https://git-scm.com/"target="_blank" rel="external nofollow noopener noreferrer">Git</a> to Commit your changes. However to ensure everyone can follow along these steps guide you using the Azure DevOps portal.</p>
</li>
<li>
<p>In the same repo create a new file called <code>buildMyContainer.yml</code> and paste the following snippet into the file.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=buildMyContainer.yml"></script></p>
</li>
<li>
<p>Make sure that the <code>containerRegistry:</code> value is set to the name of the service connection we created in the previous chapter. In case you forgot, the name of the service connection can be found in the Azure DevOps portal under <code>Project settings</code> and then <code>Service connections</code>.</p>
</li>
<li>
<p>Optionally you can change the <code>repository:</code> value to a name or path of your choice. The repository is used to identify the container in the container registry, you will see this in the example at end of these steps.</p>
</li>
<li>
<p>Next make sure the <code>Dockerfile:</code> value is set to file path of the Docker file we just created in step 1, the <code>myContainer.DockerFile</code>.</p>
</li>
<li>
<p>Optionally you can change the <code>tags:</code> value to a tag of your choice. The tag is used to identify the container in the container registry. The default value is <code>latest</code> but you can change it to anything you like. Just make sure to use the same tag when using the container in an Azure DevOps pipeline.</p>
</li>
<li>
<p>Commit the file using the button in the top right corner.</p>
</li>
<li>
<p>Create a new pipeline by clicking the <code>Pipelines</code> menu option in the Azure DevOps portal and then <code>New pipeline</code>. Select the repository where you created the <code>buildMyContainer.yml</code> file and click Continue. Then select <code>Existing Azure Pipelines YAML file</code> and select the <code>buildMyContainer.yml</code> file from the list, click Continue.</p>
</li>
<li>
<p>Finally click <code>Run</code> to start the pipeline. This pipeline will build the container and push it to the container registry.</p>
</li>
<li>
<p>Since it&rsquo;s a new pipeline, permissions to use the service connection need to be granted, you need <code>Endpoint Administrators</code> role for this. Click the <code>Review and run</code> button and then click the <code>Create</code> button to grant the necessary permissions. The pipeline will start running after the permissions have been granted.</p>
</li>
</ol>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png" data-sub-html="<h2>Provide permissions to the service connection</h2>"><img loading="lazy" src='/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png' alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png" height="624" width="1270"></a><figcaption class="image-caption">Provide permissions to the service connection</figcaption>
  </figure>
<ol start="12">
<li>Expect the build to take <strong>at least 30 minutes</strong> to complete ‚òï. When the pipeline has completed you should be able to view the container in the container registry via the Azure portal. See following screenshots.</li>
</ol>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png" data-sub-html="<h2>Successfully finished Pipeline</h2>"><img loading="lazy" src='/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png' alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png" height="714" width="1492"></a><figcaption class="image-caption">Successfully finished Pipeline</figcaption>
  </figure>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png" data-sub-html="<h2>Container registry with newly build container</h2>"><img loading="lazy" src='/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png' alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png" height="661" width="1092"></a><figcaption class="image-caption">Container registry with newly build container</figcaption>
  </figure>
<p>Assuming everything has gone according to plan the container is ready for use!</p>
<h3 class="heading-element" id="using-the-container-in-an-azure-devops-pipeline"><span>Using the container in an Azure DevOps pipeline</span>
  <a href="#using-the-container-in-an-azure-devops-pipeline" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Lets put all the hard work done during previous two chapters to good use and use the container in an Azure DevOps pipeline. The following steps will guide you through this process.</p>
<ol>
<li>
<p>Navigate back to the repo we just used in the previous chapter and create a new file called <code>myCustomContainerJob.yml</code> and paste the following snippet into the file.</p>
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=myCustomContainerJob.yml"></script>
</li>
<li>
<p>Modify the <code>image:</code> value as: <code>[Azure Container Registry Name]</code>.azurecr.io/<code>[Repository value from buildMyContainer.yml]</code>:<code>[Tag value from buildMyContainer.yml]</code> to match the container we just build and pushed to the container registry. If you left the values as specified in the snippets it should state: <code>djnsdmocr001.azurecr.io/ado/containers/windowsservercore-ltsc2022:basic</code>.</p>
</li>
<li>
<p>Modify the <code>endpoint:</code> value to match the name of the service connection we created in the <code>Setting up the required infrastructure</code> chapter. In case you forgot, the name of the service connection can be found in the Azure DevOps portal under <code>Project settings</code> and then <code>Service connections</code>.</p>
</li>
<li>
<p>Next Commit the file using the button in the top right corner.</p>
</li>
<li>
<p>Create a new pipeline by clicking the <code>Pipelines</code> menu option in the Azure DevOps portal and then <code>New pipeline</code>. Select the repository where you created the <code>myCustomContainerJob.yml</code> file and click Continue. Then select <code>Existing Azure Pipelines YAML file</code> and select the <code>myCustomContainerJob.yml</code> file from the list, click Continue.</p>
</li>
<li>
<p>Finally click <code>Run</code> to start the pipeline. The pipeline will use the container to run the pipeline steps.</p>
</li>
<li>
<p>Again, since it&rsquo;s a new pipeline permissions to use the service connection need to be granted, you need <code>Endpoint Administrators</code> role for this. Click the <code>Review and run</code> button and then click the <code>Create</code> button to grant the necessary permissions. The pipeline will start running after the permissions have been granted.</p>
</li>
</ol>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png" data-sub-html="<h2>Provide permissions to the service connection</h2>"><img loading="lazy" src='/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png' alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png" height="772" width="1814"></a><figcaption class="image-caption">Provide permissions to the service connection</figcaption>
  </figure>
<ol>
<li>Review the PowerShell steps in the pipeline, you should notice that the container is used to run the steps. Also notice the <em>Terraform  is out of date!</em> message, this message is shown because the contain definition file has version 1.7.3 defined.</li>
</ol>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png" data-sub-html="<h2>Successfully finished Pipeline</h2>"><img loading="lazy" src='/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png' alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png" height="1090" width="1128"></a><figcaption class="image-caption">Successfully finished Pipeline</figcaption>
  </figure>
<p>Congratulations, you have just successfully used your own container in an Azure DevOps pipeline.</p>
<h2 class="heading-element" id="wrapping-up"><span>Wrapping up</span>
  <a href="#wrapping-up" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>And there you have it, <em>üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶</em>. There are plenty of other configuration options available for creating and using your own containers, so make sure to check out the reference material used to make this post.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops&amp;tabs=yaml&amp;wt.mc_id=DT-MVP-5005327"target="_blank" rel="external nofollow noopener noreferrer">Microsoft-hosted agents</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/windows-agent?view=azure-devops&amp;wt.mc_id=DT-MVP-5005327"target="_blank" rel="external nofollow noopener noreferrer">Self-hosted Windows agents</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/container-phases?view=azure-devops&amp;wt.mc_id=DT-MVP-5005327"target="_blank" rel="external nofollow noopener noreferrer">Define container jobs (YAML)</a></li>
<li><a href="https://mcr.microsoft.com/"target="_blank" rel="external nofollow noopener noreferrer">Microsoft Container Registry</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-roles?tabs=azure-cli?wt.mc_id=DT-MVP-5005327"target="_blank" rel="external nofollow noopener noreferrer">Azure Container Registry roles and permissions</a></li>
<li><a href="https://github.com/Azure/azure-quickstart-templates/blob/master/quickstarts/microsoft.containerregistry/container-registry/README.md"target="_blank" rel="external nofollow noopener noreferrer">Simple Azure Container Registry Template</a></li>
<li><a href="https://github.com/PowerShell/PowerShell-Docker/blob/master/release/7-5/windowsservercore2022/docker/Dockerfile"target="_blank" rel="external nofollow noopener noreferrer">PowerShell-Docker</a></li>
<li><a href="https://code.visualstudio.com/"target="_blank" rel="external nofollow noopener noreferrer">Visual Studio Code</a></li>
<li><a href="https://git-scm.com/"target="_blank" rel="external nofollow noopener noreferrer">Git</a></li>
<li><a href="https://chocolatey.org/"target="_blank" rel="external nofollow noopener noreferrer">Chocolatey</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/azure-portal/get-subscription-tenant-id?wt.mc_id=DT-MVP-5005327"target="_blank" rel="external nofollow noopener noreferrer">Get subscription and tenant IDs in the Azure portal</a></li>
</ul>
<p>As always, a big <strong>thanks</strong> for reading this post. If you liked it, don&rsquo;t be shy and have a look at my other <a href="/posts">posts</a>.</p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod"><span title="Updated on 2024-02-23 02:00:00">Updated on 2024-02-23&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/container-jobs/" class="post-tag" title="Tags - Container Jobs">Container Jobs</a><a href="/tags/containers/" class="post-tag" title="Tags - Containers">Containers</a><a href="/tags/microsoft-hosted-agents/" class="post-tag" title="Tags - Microsoft Hosted Agents">Microsoft Hosted Agents</a><a href="/tags/self-hosted-agents/" class="post-tag" title="Tags - Self-Hosted Agents">Self-Hosted Agents</a><a href="/tags/azure-devops/" class="post-tag" title="Tags - Azure DevOps">Azure DevOps</a><a href="/tags/azure-container-registry/" class="post-tag" title="Tags - Azure Container Registry">Azure Container Registry</a><a href="/tags/docker/" class="post-tag" title="Tags - Docker">Docker</a><a href="/tags/bicep/" class="post-tag" title="Tags - Bicep">Bicep</a><a href="/tags/packer/" class="post-tag" title="Tags - Packer">Packer</a><a href="/tags/terraform/" class="post-tag" title="Tags - Terraform">Terraform</a><a href="/tags/chocolatey/" class="post-tag" title="Tags - Chocolatey">Chocolatey</a><a href="/tags/powershell/" class="post-tag" title="Tags - PowerShell">PowerShell</a></section>
    <section><span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/2024/azure-devops-container-jobs-when-microsoft-and-self-hosted-agents-meet-its-the-best-of-both-worlds/" class="post-nav-item" rel="prev" title="üöÄ Azure DevOps Container Jobs: When Microsoft and Self-Hosted Agents Meet, It&#39;s the Best of Both Worlds! üåêüõ†Ô∏è"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>üöÄ Azure DevOps Container Jobs: When Microsoft and Self-Hosted Agents Meet, It&#39;s the Best of Both Worlds! üåêüõ†Ô∏è</a><a href="/posts/2024/400-bad-request-access-to-outlook-on-the-web-has-been-blocked-by-your-organization/" class="post-nav-item" rel="next" title="üö´ 400 Bad Request. Access to Outlook on the Web Has Been Blocked by Your Organization üõë‚úâÔ∏èüîí">üö´ 400 Bad Request. Access to Outlook on the Web Has Been Blocked by Your Organization üõë‚úâÔ∏èüîí<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="custom-footer-text">
  <p>¬© 2025 Jev Suchoi - Let's automate the boring! </p>
</div>
<div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/config.js" defer></script><script src="/js/theme.min.js" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-J3E897NYLC');
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-J3E897NYLC" async></script></body>
</html>
