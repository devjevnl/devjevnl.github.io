<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶ - </title><meta name="Description" content="How to create your own container to use in container jobs?"><meta property="og:title" content="üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶" />
<meta property="og:description" content="How to create your own container to use in container jobs?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/" /><meta property="og:image" content="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-23T02:00:00+02:00" />
<meta property="article:modified_time" content="2024-02-23T02:00:00+02:00" /><meta property="og:site_name" content="DevJev.NL" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg" /><meta name="twitter:title" content="üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶"/>
<meta name="twitter:description" content="How to create your own container to use in container jobs?"/>
<meta name="twitter:site" content="@DevJevNL"/>
<meta name="application-name" content="">
<meta name="apple-mobile-web-app-title" content=""><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.devjev.nl/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/" /><link rel="prev" href="https://www.devjev.nl/posts/2024/azure-devops-container-jobs-when-microsoft-and-self-hosted-agents-meet-its-the-best-of-both-worlds/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.devjev.nl\/posts\/2024\/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/www.devjev.nl\/posts\/2024\/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs\/featured-image.jpg",
                            "width":  500 ,
                            "height":  690 
                        }],"genre": "posts","keywords": "Container Jobs, Containers, Microsoft Hosted Agents, Self-Hosted Agents, Azure DevOps, Azure Container Registry, Docker, Bicep, Packer, Terraform, Chocolatey, PowerShell","wordcount":  1722 ,
        "url": "https:\/\/www.devjev.nl\/posts\/2024\/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs\/","datePublished": "2024-02-23T02:00:00+02:00","dateModified": "2024-02-23T02:00:00+02:00","publisher": {
            "@type": "Organization",
            "name": "Jev"},"author": {
                "@type": "Person",
                "name": "Jev"
            },"description": "How to create your own container to use in container jobs?"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="">DevJev.NL</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="Blog posts"> Posts </a><a class="menu-item" href="/categories/" title="Post categories"> Categories </a><a class="menu-item" href="/tags/" title="Tags used in posts"> Tags </a><a class="menu-item" href="/about/" title="About Me"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="">DevJev.NL</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="Blog posts">Posts</a><a class="menu-item" href="/categories/" title="Post categories">Categories</a><a class="menu-item" href="/tags/" title="Tags used in posts">Tags</a><a class="menu-item" href="/about/" title="About Me">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Jev</a>
</span>&nbsp;<span class="post-category">included in <a href="/categories/azure-devops/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Azure DevOps</a>&nbsp;<a href="/categories/container-jobs/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Container Jobs</a>&nbsp;<a href="/categories/containers/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Containers</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-02-23">2024-02-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1722 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;9 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg"
        data-srcset="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg 1.5x, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg 2x"
        data-sizes="auto"
        alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/featured-image.jpg"
        title="How to create your own container to use in container jobs?" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#target-set-up">Target set-up</a>
      <ul>
        <li><a href="#setting-up-the-required-infrastructure">Setting up the required infrastructure</a></li>
        <li><a href="#building-and-storing-the-container">Building and storing the container</a></li>
        <li><a href="#using-the-container-in-an-azure-devops-pipeline">Using the container in an Azure DevOps pipeline</a></li>
      </ul>
    </li>
    <li><a href="#wrapping-up">Wrapping up</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>In my previous post <a href="/posts/2024/azure-devops-container-jobs-when-microsoft-and-self-hosted-agents-meet-its-the-best-of-both-worlds" rel="">üöÄ Azure DevOps Container Jobs: When Microsoft and Self-Hosted Agents meet, It&rsquo;s the Best of Both Worlds! üåêüõ†Ô∏è</a>
 you where able experience Azure DevOps container jobs. In this post I am delivering on my promise and explain set-by-step how to build and use your own container with Azure DevOps Container Jobs. Buckle up, and let&rsquo;s get started!</p>
<h2 id="target-set-up">Target set-up</h2>
<p>Lets start by having a look at the target set-up.</p>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png" data-sub-html="<h2>Target set-up</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png"
            data-srcset="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png 1.5x, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png 2x"
            data-sizes="auto"
            alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/set-up-schematic.png" width="1302" height="1472" />
    </a><figcaption class="image-caption">Target set-up</figcaption>
    </figure>
<p>The goal of this set-up is to fist build your own container then store the container in a container registry and finally use the container in an Azure DevOps pipeline as a container job. Naturally some infrastructure needs to be in place to make this happen, but thats nothing to worry about as everything needed for to achieve the target set-up is included in this post.</p>
<p>With a clear understanding of what we want to achieve lets start building it.</p>
<div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>Prerequisites<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>The next chapters assume that you have met the following prerequisites:</p>
<ul>
<li>An Azure DevOps Organization with a Microsoft hosted agent is available and accessible to you</li>
<li>A project in the concerning Azure DevOps organization exists
<ul>
<li>Contributor and Endpoint Administrator roles granted to your identity in this project</li>
</ul>
</li>
<li>A n initialized Git repo in the concerning project is present</li>
<li>You have access to an Azure Subscription with contributor permissions</li>
<li>Your engineering/development environment has been set up as follow
<ul>
<li>Your environment has the latest PowerShell version installed</li>
<li>Your environment has the latest Az module installed</li>
<li>Your environment has the latest Bicep version installed</li>
</ul>
</li>
</ul></div>
        </div>
    </div>
<h3 id="setting-up-the-required-infrastructure">Setting up the required infrastructure</h3>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">The steps in this chapter are to ensure that everyone can follow the instructions disregarding the level of experience with the subjects at hand. If you are already familiar with Infrastructure as Code in Azure and how to set-up Service Connections in Azure DevOps you can probably skip most of the steps if not the whole chapter.</div>
        </div>
    </div>
<p>Our first task is to create a place to store the container after it has been built. For this we are going to use an <a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-intro?wt.mc_id=DT-MVP-5005327" target="_blank" rel="noopener noreffer">Azure Container registry</a>
.</p>
<ol>
<li>
<p>Open a PowerShell terminal and connect to your Azure subscription by running the following snippet. Make sure fill your <a href="https://learn.microsoft.com/en-us/azure/azure-portal/get-subscription-tenant-id?wt.mc_id=DT-MVP-5005327" target="_blank" rel="noopener noreffer">subscription id and tenant id</a>
.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=connectAzSubscription.ps1"></script>
</p>
</li>
<li>
<p>Next lets create a resource group by running the following snippet. Feel free to change the resource group name to something of your choice.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=createResourceGroup.ps1"></script>
</p>
</li>
<li>
<p>Now save the following snippet as  a file named <code>basicContainerRegistry.bicep</code> to your local machine.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=basicContainerRegistry.bicep"></script>
</p>
</li>
<li>
<p>The prerequisites to create an Azure Container Registry are met. Run the following snippet in the PowerShell terminal opened in step 1 to start the deployment.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=deployBasicContainerRegistry.ps1"></script>
</p>
<p>Assuming the deployment was successful you should see something like this in the terminal. It&rsquo;s also possible to verify the result using the Azure portal.
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png" data-sub-html="<h2>Successful Bicep deployment</h2>">
           <img
               class="lazyload"
               src="/svg/loading.min.svg"
               data-src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png"
               data-srcset="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png 1.5x, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png 2x"
               data-sizes="auto"
               alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/bicep-deploy-result.png" width="781" height="316" />
       </a><figcaption class="image-caption">Successful Bicep deployment</figcaption>
       </figure></p>
</li>
<li>
<p>We are ready to create a service connection in Azure DevOps to the container registry. This service connection will be used to push the container to the just created container registry.
<div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>Prerequisites<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Make sure you have the necessary permissions to create a service connection in Azure DevOps. Meaning your identity has at least contributor role for the concerning project.
Also make sure the same identity has direct or inherited Owner permissions on the newly created Azure Container Registry.</div>
        </div>
    </div></p>
<ol>
<li>Open the Azure DevOps portal and navigate to the project you want to use the container registry in.</li>
<li>In the project navigate to <code>Project settings</code> and then <code>Service connections</code>.</li>
<li>Click <code>New service connection</code> in the top right corner and select <code>Docker Registry</code> as the connection type, click next.</li>
<li>For <code>Registry type</code> select <code>Azure Container Registry</code> and for <code>Authentication Type</code> select <code>Service Principal</code>, a list of subscriptions should be loaded within a couple of seconds.</li>
<li>Select the subscription where the newly created container registry is located and select the correct container registry from the list of available container registries.</li>
<li>Give the service connection a name, in this guide the name of the Azure container Registry is used but you can use any name you like.</li>
<li>Write a proper description and click <code>Save</code>. The service connection is now available for use in the project.</li>
</ol>
</li>
</ol>
<p>All the prerequisites are now in place to start building the container.</p>
<h3 id="building-and-storing-the-container">Building and storing the container</h3>
<p>Our next task is create a container definition, a pipeline to build the container and finally push the finished result to the container registry we just created in the previous chapter.</p>
<ol>
<li>Assuming you still have your Azure DevOps Project open in your browser, select your repo, create a new file called <code>myContainer.DockerFile</code> and paste the following snippet into the file.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=myContainer.DockerFile"></script>
</li>
</ol>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw" aria-hidden="true"></i>Tip<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Review the Docker file, you should notice that it uses the PowerShell 7.3 image from the <a href="https://mcr.microsoft.com/" target="_blank" rel="noopener noreffer">Microsoft Container Registry</a>
 as a base, adds a couple of preview PowerShell modules to it and finally installs <a href="https://chocolatey.org/" target="_blank" rel="noopener noreffer">Chocolatey</a>
. Chocolatey is then used to install <a href="https://www.packer.io/" target="_blank" rel="noopener noreffer">Packer</a>
, <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview?tabs=bicep&amp;wt.mc_id=DT-MVP-5005327" target="_blank" rel="noopener noreffer">Bicep</a>
 and <a href="https://www.terraform.io/" target="_blank" rel="noopener noreffer">Terraform</a>
. It is completely up to you what you want to add to the container, this set-up is an example to showcase the possibilities, and give you some inspiration.</div>
        </div>
    </div>
<ol start="2">
<li>
<p>Next Commit the file using the button in the top right corner. Preferably you should use an IDE like <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreffer">Visual Studio Code</a>
 and <a href="https://git-scm.com/" target="_blank" rel="noopener noreffer">Git</a>
 to Commit your changes. However to ensure everyone can follow along these steps guide you using the Azure DevOps portal.</p>
</li>
<li>
<p>In the same repo create a new file called <code>buildMyContainer.yml</code> and paste the following snippet into the file.
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=buildMyContainer.yml"></script>
</p>
</li>
<li>
<p>Make sure that the <code>containerRegistry:</code> value is set to the name of the service connection we created in the previous chapter. In case you forgot, the name of the service connection can be found in the Azure DevOps portal under <code>Project settings</code> and then <code>Service connections</code>.</p>
</li>
<li>
<p>Optionally you can change the <code>repository:</code> value to a name or path of your choice. The repository is used to identify the container in the container registry, you will see this in the example at end of these steps.</p>
</li>
<li>
<p>Next make sure the <code>Dockerfile:</code> value is set to file path of the Docker file we just created in step 1, the <code>myContainer.DockerFile</code>.</p>
</li>
<li>
<p>Optionally you can change the <code>tags:</code> value to a tag of your choice. The tag is used to identify the container in the container registry. The default value is <code>latest</code> but you can change it to anything you like. Just make sure to use the same tag when using the container in an Azure DevOps pipeline.</p>
</li>
<li>
<p>Commit the file using the button in the top right corner.</p>
</li>
<li>
<p>Create a new pipeline by clicking the <code>Pipelines</code> menu option in the Azure DevOps portal and then <code>New pipeline</code>. Select the repository where you created the <code>buildMyContainer.yml</code> file and click Continue. Then select <code>Existing Azure Pipelines YAML file</code> and select the <code>buildMyContainer.yml</code> file from the list, click Continue.</p>
</li>
<li>
<p>Finally click <code>Run</code> to start the pipeline. This pipeline will build the container and push it to the container registry.</p>
</li>
<li>
<p>Since it&rsquo;s a new pipeline, permissions to use the service connection need to be granted, you need <code>Endpoint Administrators</code> role for this. Click the <code>Review and run</code> button and then click the <code>Create</code> button to grant the necessary permissions. The pipeline will start running after the permissions have been granted.</p>
</li>
</ol>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png" data-sub-html="<h2>Provide permissions to the service connection</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png"
            data-srcset="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png 1.5x, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png 2x"
            data-sizes="auto"
            alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer-src-permissions.png" width="1270" height="624" />
    </a><figcaption class="image-caption">Provide permissions to the service connection</figcaption>
    </figure>
<ol start="12">
<li>Expect the build to take <strong>at least 30 minutes</strong> to complete ‚òï. When the pipeline has completed you should be able to view the container in the container registry via the Azure portal. See following screenshots.</li>
</ol>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png" data-sub-html="<h2>Successfully finished Pipeline</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png"
            data-srcset="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png 1.5x, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png 2x"
            data-sizes="auto"
            alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/buildMyContainer.yml-finished.png" width="1492" height="714" />
    </a><figcaption class="image-caption">Successfully finished Pipeline</figcaption>
    </figure>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png" data-sub-html="<h2>Container registry with newly build container</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png"
            data-srcset="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png 1.5x, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png 2x"
            data-sizes="auto"
            alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/container-registry-finished.png" width="1092" height="661" />
    </a><figcaption class="image-caption">Container registry with newly build container</figcaption>
    </figure>
<p>Assuming everything has gone according to plan the container is ready for use!</p>
<h3 id="using-the-container-in-an-azure-devops-pipeline">Using the container in an Azure DevOps pipeline</h3>
<p>Lets put all the hard work done during previous two chapters to good use and use the container in an Azure DevOps pipeline. The following steps will guide you through this process.</p>
<ol>
<li>
<p>Navigate back to the repo we just used in the previous chapter and create a new file called <code>myCustomContainerJob.yml</code> and paste the following snippet into the file.</p>
<script src="https://gist.github.com/devjevnl/faf3a002e2b394f531c718a66cac1069.js?file=myCustomContainerJob.yml"></script>

</li>
<li>
<p>Modify the <code>image:</code> value as: <code>[Azure Container Registry Name]</code>.azurecr.io/<code>[Repository value from buildMyContainer.yml]</code>:<code>[Tag value from buildMyContainer.yml]</code> to match the container we just build and pushed to the container registry. If you left the values as specified in the snippets it should state: <code>djnsdmocr001.azurecr.io/ado/containers/windowsservercore-ltsc2022:basic</code>.</p>
</li>
<li>
<p>Modify the <code>endpoint:</code> value to match the name of the service connection we created in the <code>Setting up the required infrastructure</code> chapter. In case you forgot, the name of the service connection can be found in the Azure DevOps portal under <code>Project settings</code> and then <code>Service connections</code>.</p>
</li>
<li>
<p>Next Commit the file using the button in the top right corner.</p>
</li>
<li>
<p>Create a new pipeline by clicking the <code>Pipelines</code> menu option in the Azure DevOps portal and then <code>New pipeline</code>. Select the repository where you created the <code>myCustomContainerJob.yml</code> file and click Continue. Then select <code>Existing Azure Pipelines YAML file</code> and select the <code>myCustomContainerJob.yml</code> file from the list, click Continue.</p>
</li>
<li>
<p>Finally click <code>Run</code> to start the pipeline. The pipeline will use the container to run the pipeline steps.</p>
</li>
<li>
<p>Again, since it&rsquo;s a new pipeline permissions to use the service connection need to be granted, you need <code>Endpoint Administrators</code> role for this. Click the <code>Review and run</code> button and then click the <code>Create</code> button to grant the necessary permissions. The pipeline will start running after the permissions have been granted.</p>
</li>
</ol>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png" data-sub-html="<h2>Provide permissions to the service connection</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png"
            data-srcset="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png 1.5x, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png 2x"
            data-sizes="auto"
            alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-src-permissions.png" width="1814" height="772" />
    </a><figcaption class="image-caption">Provide permissions to the service connection</figcaption>
    </figure>
<ol>
<li>Review the PowerShell steps in the pipeline, you should notice that the container is used to run the steps. Also notice the <em>Terraform  is out of date!</em> message, this message is shown because the contain definition file has version 1.7.3 defined.</li>
</ol>
<figure><a class="lightgallery" href="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png" title="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png" data-thumbnail="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png" data-sub-html="<h2>Successfully finished Pipeline</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png"
            data-srcset="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png 1.5x, /posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png 2x"
            data-sizes="auto"
            alt="/posts/2024/how-to-build-and-use-your-own-container-with-azure-devops-container-jobs/myCustomContainerJob-finished.png" width="1128" height="1090" />
    </a><figcaption class="image-caption">Successfully finished Pipeline</figcaption>
    </figure>
<p>Congratulations, you have just successfully used your own container in an Azure DevOps pipeline.</p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>And there you have it, <em>üõ†Ô∏è How to Build and Use Your Own Container with Azure DevOps Container Jobs üöÄüì¶</em>. There are plenty of other configuration options available for creating and using your own containers, so make sure to check out the reference material used to make this post.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops&amp;tabs=yaml&amp;wt.mc_id=DT-MVP-5005327" target="_blank" rel="noopener noreffer">Microsoft-hosted agents</a>
</li>
<li><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/windows-agent?view=azure-devops&amp;wt.mc_id=DT-MVP-5005327" target="_blank" rel="noopener noreffer">Self-hosted Windows agents</a>
</li>
<li><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/container-phases?view=azure-devops&amp;wt.mc_id=DT-MVP-5005327" target="_blank" rel="noopener noreffer">Define container jobs (YAML)</a>
</li>
<li><a href="https://mcr.microsoft.com/" target="_blank" rel="noopener noreffer">Microsoft Container Registry</a>
</li>
<li><a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-roles?tabs=azure-cli?wt.mc_id=DT-MVP-5005327" target="_blank" rel="noopener noreffer">Azure Container Registry roles and permissions</a>
</li>
<li><a href="https://github.com/Azure/azure-quickstart-templates/blob/master/quickstarts/microsoft.containerregistry/container-registry/README.md" target="_blank" rel="noopener noreffer">Simple Azure Container Registry Template</a>
</li>
<li><a href="https://github.com/PowerShell/PowerShell-Docker/blob/master/release/7-5/windowsservercore2022/docker/Dockerfile" target="_blank" rel="noopener noreffer">PowerShell-Docker</a>
</li>
<li><a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreffer">Visual Studio Code</a>
</li>
<li><a href="https://git-scm.com/" target="_blank" rel="noopener noreffer">Git</a>
</li>
<li><a href="https://chocolatey.org/" target="_blank" rel="noopener noreffer">Chocolatey</a>
</li>
<li><a href="https://learn.microsoft.com/en-us/azure/azure-portal/get-subscription-tenant-id?wt.mc_id=DT-MVP-5005327" target="_blank" rel="noopener noreffer">Get subscription and tenant IDs in the Azure portal</a>
</li>
</ul>
<p>As always, a big <strong>thanks</strong> for reading this post. If you liked it, don&rsquo;t be shy and have a look at my other <a href="/posts" rel="">posts</a>
.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-02-23</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/container-jobs/">Container Jobs</a>,&nbsp;<a href="/tags/containers/">Containers</a>,&nbsp;<a href="/tags/microsoft-hosted-agents/">Microsoft Hosted Agents</a>,&nbsp;<a href="/tags/self-hosted-agents/">Self-Hosted Agents</a>,&nbsp;<a href="/tags/azure-devops/">Azure DevOps</a>,&nbsp;<a href="/tags/azure-container-registry/">Azure Container Registry</a>,&nbsp;<a href="/tags/docker/">Docker</a>,&nbsp;<a href="/tags/bicep/">Bicep</a>,&nbsp;<a href="/tags/packer/">Packer</a>,&nbsp;<a href="/tags/terraform/">Terraform</a>,&nbsp;<a href="/tags/chocolatey/">Chocolatey</a>,&nbsp;<a href="/tags/powershell/">PowerShell</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2024/azure-devops-container-jobs-when-microsoft-and-self-hosted-agents-meet-its-the-best-of-both-worlds/" class="prev" rel="prev" title="üöÄ Azure DevOps Container Jobs: When Microsoft and Self-Hosted Agents meet, It&#39;s the Best of Both Worlds! üåêüõ†Ô∏è"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>üöÄ Azure DevOps Container Jobs: When Microsoft and Self-Hosted Agents meet, It&#39;s the Best of Both Worlds! üåêüõ†Ô∏è</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Let's automate the boring!</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Jev Suchoi</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":-1},"comment":{},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-J3E897NYLC');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-J3E897NYLC" async></script></body>
</html>
